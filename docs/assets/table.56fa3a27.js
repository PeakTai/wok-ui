import{M as i,b as E,g as h,s as B,c as m,D as b,T as f,F as D,L as F,S as l,H as o,r,P as a,j as C}from"./index.936704ca.js";import{C as k,B as A}from"./bool-checkbox.0c356a89.js";import"./invalid-feedback.86259d42.js";class T extends i{constructor(e){super(document.createElement("tr")),e.cols.forEach(t=>{this.addChild(new p({data:e.data,col:t,rowIdx:e.rowIdx}))})}}class p extends i{constructor(e){super(document.createElement("td"));const t=e.col.setting.content(e.data,e.rowIdx);t instanceof Promise?(this.el.innerText="\u52A0\u8F7D\u4E2D...",t.then(s=>{this.el.innerText="",typeof s=="string"?this.el.innerText=s:this.addChild(s)}).catch(s=>{this.el.innerText="",this.addChild(new E({text:"\u52A0\u8F7D\u5931\u8D25",color:h().danger})),B(s)})):this.addChild(t)}}class y extends i{constructor(e){super(document.createElement("tbody")),this.addChild(...e.list.map((t,s)=>new T({data:t,cols:e.cols,rowIdx:s})))}}class V extends i{constructor(e){super(document.createElement("thead")),this.addChild(m({tag:"tr",children:e.cols.map(t=>{const s=t.setting.width&&t.setting.width>0?t.setting.width:80;return new S(t.setting.name,s)})}))}}class S extends i{constructor(e,t){if(super(document.createElement("th")),this.el.style.width=`${t}px`,typeof e=="string"){this.el.innerText=e;return}this.addChild(e)}}class v extends b{constructor(e){super("kk-table"),e.bordered&&this.el.classList.add("bordered"),this.addChild(m({tag:"table",children:[new V({cols:e.cols}),new y({table:this,list:e.list,cols:e.cols})]}))}}class n{constructor(e){this.setting=e}}class $ extends n{constructor(e){let t;e.name||(t=new k({status:"unchecked",onChange:s=>{!t||(t.isChecked()?this.boxes.forEach(c=>c.setStatus("checked")):this.boxes.forEach(c=>c.setStatus("unchecked")),e.onChange&&e.onChange(this.getCheckedValues()))},value:""})),super({name:e.name||t||"",content:(s,c)=>{const x=e.value(s,c),w=e.checked?e.checked(s,c):!1,d=new k({status:w?"checked":"unchecked",value:x,onChange:()=>{const g=this.getCheckedValues();e.onChange&&e.onChange(g),this.updateCheckAllBox()}});return this.boxes.push(d),d},width:30}),this.boxes=[],this.checkAllBox=t}updateCheckAllBox(){if(!this.checkAllBox)return;const e=this.getCheckedValues();e.length===this.boxes.length?this.checkAllBox.setStatus("checked"):e.length===0?this.checkAllBox.setStatus("unchecked"):this.checkAllBox.setStatus("indeterminate")}getCheckedValues(){return this.boxes.filter(e=>e.isChecked()).map(e=>e.value)}checkAll(){this.checkAllBox&&this.checkAllBox.setStatus("checked"),this.boxes.forEach(e=>e.setStatus("checked"))}uncheckAll(){this.checkAllBox&&this.checkAllBox.setStatus("unchecked"),this.boxes.forEach(e=>e.setStatus("unchecked"))}}class M extends n{constructor(){super({name:"#",content:(e,t)=>`${t+1}`,width:30})}}class I extends D{constructor(){super(),this.list=[{id:"001",name:"\u5F20\u4E09",age:25,city:"\u5317\u4EAC",gender:"\u7537",dept:"\u7814\u53D1\u90E8",status:"\u6FC0\u6D3B"},{id:"002",name:"\u674E\u56DB",age:28,city:"\u4E0A\u6D77",gender:"\u7537",dept:"\u7814\u53D1\u90E8",status:"\u6FC0\u6D3B"},{id:"003",name:"\u738B\u4E94",age:32,city:"\u5E7F\u5DDE",gender:"\u7537",dept:"\u9500\u552E\u90E8",status:"\u51BB\u7ED3"},{id:"004",name:"\u9A6C\u516D",age:33,city:"\u6DF1\u5733",gender:"\u7537",dept:"\u7814\u53D1\u90E8",status:"\u6FC0\u6D3B"}],this.checkedVals=[],this.bordered=!0,this.render()}buildContent(){this.addChild(new F("\u8868\u683C"),new l(20),new o({gap:r(1),children:[new A({label:"\u663E\u793A\u8FB9\u6846",value:this.bordered,onChange:e=>{this.bordered=e,this.removeCache("table"),this.render()}}),new a(this.checkedVals?`\u5DF2\u9009\u62E9\uFF1A${JSON.stringify(this.checkedVals)}`:"\u672A\u9009\u62E9\u4EFB\u4F55\u6761\u76EE")]}),new l(10),this.cacheModule({key:"table",module:()=>new v({bordered:this.bordered,list:this.list,cols:[new $({value:e=>e.id,onChange:e=>{this.checkedVals=e,this.render()},checked:e=>this.checkedVals.includes(e.id)}),new M,new n({name:"\u59D3\u540D",content:e=>e.name}),new n({name:"\u5E74\u9F84",content:e=>`${e.age}`}),new n({name:"\u6027\u522B",content:e=>`${e.gender}`,width:60}),new n({name:"\u57CE\u5E02",content:e=>`${e.city}`}),new n({name:"\u90E8\u95E8",content:e=>`${e.dept}`,width:100}),new n({name:"\u79EF\u5206",content:e=>new Promise((t,s)=>{setTimeout(()=>{const c=Math.random()*1e3;if(c<500){s(`\u52A0\u8F7D${e.name}\u7684\u79EF\u5206\u5931\u8D25`);return}t(c.toFixed(1))},2e3)})}),new n({name:"\u72B6\u6001",content:e=>e.status==="\u6FC0\u6D3B"?new a("\u6FC0\u6D3B").setColor(h().success):new a("\u51BB\u7ED3").setColor(h().danger)}),new n({name:"\u64CD\u4F5C",content:e=>new o({gap:r(.5),children:[new C({content:e.status==="\u6FC0\u6D3B"?"\u51BB\u7ED3":"\u6FC0\u6D3B",onClick:()=>{e.status=e.status==="\u6FC0\u6D3B"?"\u51BB\u7ED3":"\u6FC0\u6D3B",this.removeCache("table"),this.render()}}),new C({content:"\u5220\u9664",onClick:()=>{if(!confirm("\u786E\u5B9A\u8981\u5220\u9664\u6761\u76EE\u5417"))return;const t=this.list.indexOf(e);this.list.splice(t,1);const s=this.checkedVals.indexOf(e.id);s!==-1&&this.checkedVals.splice(s,1),this.removeCache("table"),this.render()}})]}),width:100})]})}))}}function O(){return new f(new I)}export{O as tableTest};
