import{D as h,j as m,k as r,A as a,B as d,g as c,s as y}from"./index.6dd5bfd6.js";class f extends h{constructor(e){super("wok-ui-modal"),this.opts=e,this.escapeCloseListener=t=>{if(t.key==="Escape"){const i=this.getChildren();i.length&&i[i.length-1].tryDestroy()}},document.addEventListener("keydown",this.escapeCloseListener),this.docChangeCloseListener=()=>this.empty(),window.addEventListener("popstate",this.docChangeCloseListener)}addDialog(e){e.onDestroy(()=>{this.getChildren().length===0&&this.destroy()}),this.addChild(e)}removeChild(e){const t=super.removeChild(e);return this.getChildren().length===0&&this.destroy(),t}mount(e){super.mount(e),document.body.classList.add("wok-ui-modal-lock-scroll")}empty(){super.empty()}destroy(){document.removeEventListener("keydown",this.escapeCloseListener),window.removeEventListener("popstate",this.docChangeCloseListener),document.body.classList.remove("wok-ui-modal-lock-scroll"),super.destroy(),this.opts.onDestroy()}}class w extends h{constructor(e){if(super("wok-ui-modal-dialog",m),this.opts=e,this.callbacked=!1,this.leaveAnimating=!1,r({el:this.el,animation:a.SLIDE_TOP,duration:300}).then(()=>{e.onShown&&e.onShown()}),this.opts.fullscreen?this.el.classList.add("fullscreen"):this.opts.dialogCentered&&this.el.classList.add("centered"),this.el.addEventListener("click",t=>{t.stopPropagation(),this.tryDestroy()}),e.replaceByBody){this.addChild({classNames:["wok-ui-modal-content"],style:{borderRadius:e.borderRadius&&e.borderRadius>0?`${e.borderRadius}px`:void 0,width:e.fullscreen?void 0:e.width&&e.width>0?`${e.width}px`:"500px"},onClick(t){t.stopPropagation()},children:e.body});return}this.addChild({classNames:["wok-ui-modal-content","normal"],style:{borderRadius:e.borderRadius&&e.borderRadius>0?`${e.borderRadius}px`:void 0,width:e.fullscreen?void 0:e.width&&e.width>0?`${e.width}px`:"500px"},onClick(t){t.stopPropagation()},children:t=>{if(e.title&&t({classNames:["wok-ui-modal-header"],children:i=>{i({classNames:["title"],innerText:e.title}),e.closeBtn!==!1&&i({classNames:["close"],innerHTML:"&times;",onClick:()=>this.destroy()})}}),t({classNames:["wok-ui-modal-body"],children:e.body}),e.footer)t(e.footer);else if(e.buttons&&(e.buttons.cancel||e.buttons.confirm)){const{confirm:i,cancel:n}=e.buttons;t({classNames:["wok-ui-modal-footer"],children:l=>{i&&l(new d({text:typeof i=="string"?i:c().buildMsg("confirm"),type:"primary",onClick(u){e.onConfirm&&e.onConfirm()}})),n&&l(new d({text:typeof n=="string"?n:c().buildMsg("cancel"),onClick:u=>this.destroy()}))}})}}})}tryDestroy(){if(this.opts.staticBackDrop){r({el:this.el,animation:a.SHAKE}).catch(y);return}this.destroy()}onDestroy(e){this.destroyListener=e}async leave(){this.leaveAnimating=!0;try{await r({el:this.el,animation:a.SLIDE_TOP,duration:300,reverse:!0})}finally{this.leaveAnimating=!1}}destroy(){this.leaveAnimating||this.leave().then(()=>{super.destroy(),this.destroyListener&&this.destroyListener(),this.opts.onClose&&!this.callbacked&&(this.opts.onClose(),this.callbacked=!0)})}}let s;function k(o){s||(s=new f({onDestroy:()=>s=void 0}),s.mount(document.body));const e=new w(o);return s.addDialog(e),{close:()=>e.destroy()}}export{k as s};
